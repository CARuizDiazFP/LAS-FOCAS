# Nombre de archivo: 2025-10-24.md
# Ubicación de archivo: docs/PR/2025-10-24.md
# Descripción: Registro de cambios diarios del 24-10-2025

## 1. Resumen de cambios
- SLA ahora puede calcularse directamente desde la base `app.reclamos`, incluyendo preview JSON filtrable.
- La pestaña SLA del panel web incorpora toggles Excel/DB, opción de PDF, narrativa editable y visor de preview.
- Documentación web y plan Mate_y_Ruta actualizados para reflejar el nuevo flujo.

## 2. Contexto y alcance
- Proyecto LAS-FOCAS, módulo de informes SLA (backend `core/services/sla`, API `/api/flows/sla`, frontend `web`).
- Alcance limitado a cálculo desde DB, mejoras de UI y documentación. No se abordaron comparador FO ni workers asíncronos.

## 3. Cambios realizados
- Implementación de `compute_from_db` con normalización de columnas y tz (`core/services/sla.py`).
- Ajustes en `POST /api/flows/sla` y `GET /api/flows/sla/preview` para soportar `usar_db`, narrativa y preview (`api/api_app/routes/reports.py`).
- Nuevos controles y preview en `web/templates/panel.html` y lógica JS asociada en `web/static/panel.js`.
- Prueba adicional `test_compute_from_db_normaliza` en `tests/test_sla_module.py`.
- Documentación actualizada (`docs/web.md`, `docs/Mate_y_Ruta.md`).

## 4. Tareas realizadas y pendientes
- [x] Cálculo SLA con datos de DB reutilizando motor existente.
- [x] UI SLA con toggles DB/PDF, narrativa y preview.
- [x] Cobertura unitaria para la ruta DB.
- [ ] Golden files y pruebas de regresión DOCX/PDF.
- [ ] Integración comparador FO y workers para cargas largas.

## 5. Criterios de aceptación y validación
- `pytest tests/test_sla_module.py` ✔️
- Preview devuelve métricas coherentes (validado vía test unitario, pendiente smoke manual en panel una vez desplegado).

## 6. Impacto en seguridad y datos
- Se mantiene uso de credenciales vía variables de entorno; no se exponen datos sensibles en logs.
- Preview y generación usan endpoints autenticados existentes; sin nuevos puertos ni scopes.

## 7. Compatibilidad y migraciones
- Sin migraciones de DB.
- API `/api/flows/sla` agrega campos opcionales retro-compatibles; UI antigua sigue operativa enviando sólo `file/mes/anio`.

## 8. Evidencia de validación manual
- No se ejecutaron pruebas manuales en UI (requiere entorno desplegado). Pendiente smoke test en entorno Docker.

## 9. Próximos pasos
- Preparar golden files para SLA (DOCX/PDF) y ampliar suite de integración.
- Documentar flujo en `docs/informes/sla.md` (futuro) y agregar ejemplos curl para preview.
- Coordinar smoke test en panel + verificación con datos reales de octubre.
