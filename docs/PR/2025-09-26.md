# Nombre de archivo: 2025-09-26.md
# Ubicación de archivo: docs/PR/2025-09-26.md
# Descripción: Registro diario de cambios y avances (26-09-2025)

## Resumen de cambios
Login web reparado. Se fijó versión de bcrypt y se implementó fallback en script de mantenimiento para restablecer/verificar contraseña admin. Ahora el flujo de autenticación retorna `result=success` y la UI /login responde 200 (ver curl). Documentada decisión técnica.

## Contexto y alcance
- Servicio afectado: web (FastAPI UI)
- Problema: `passlib.hash.bcrypt` fallaba con AttributeError y devolvía verificación falsa negativa.
- Cambios limitados a: `web/requirements.txt`, `web/tools/reset_admin_password.py`, `web/Dockerfile`, `docs/decisiones.md`.

## Cambios realizados
1. Pin `bcrypt==4.1.2` en `web/requirements.txt`.
2. Script `reset_admin_password.py`: agrega fallback a librería bcrypt nativa, truncado 72 bytes, manejo de excepciones y mensajes claros.
3. Rebuild de imagen `web` con nuevas dependencias.
4. Reset y verificación exitosa de contraseña admin (`verify(password) -> True`).
5. Registro de decisión en `docs/decisiones.md`.

## Tareas realizadas
- [x] Fijar versión bcrypt.
- [x] Mejorar script de reset.
- [x] Reconstruir contenedor y validar login por curl.
- [x] Documentar decisión.

## Tareas pendientes / TODO
- [ ] Evaluar migración futura a Argon2 (`passlib.hash.argon2`) para endurecer seguridad.
- [ ] Añadir prueba automatizada de login end-to-end (FastAPI TestClient) validando cookie de sesión.
- [ ] Revisión periódica de dependencias de seguridad (automatizar pipeline SCA).

## Criterios de aceptación
- Login devuelve 302 al POST con credenciales correctas (ver curl).
- Log contiene `action=login result=success`.
- Herramienta de reset produce hash y verificación True.

## Evidencia
```
POST /login -> 302 Found, Set-Cookie session=...
Log: 2025-09-26 ... level=INFO msg=action=login result=success username=admin
Script verify: [INFO] verify(password) -> True.
```

## Seguridad e impacto en datos
- No se exponen hashes en logs (solo en script manual si se ejecuta). Hash bcrypt costo 12.
- Fijar versión reduce superficie de vulnerabilidades por cambios futuros inesperados.

## Compatibilidad y migraciones
- Sin cambios de esquema. Sólo actualización de imagen.

## Próximos pasos
1. Implementar test E2E de login.
2. Revisar token CSRF y considerar SameSite=Strict + Secure (cuando se use HTTPS).
3. Evaluar Argon2 para nueva política de hashing y proceso de rehash.

