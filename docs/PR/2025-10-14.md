# Nombre de archivo: 2025-10-14.md
# Ubicación de archivo: docs/PR/2025-10-14.md
# Descripción: Nota de PR diario del 2025-10-14 (cambios UI/Docs y fixes rutas)

# PR — 2025-10-14

## Resumen de cambios
- Web UI: corregida ruta de histórico de reportes (nuevo `/reports-history`, con redirect desde `/reports/index`).
- Web UI: panel con Chat por defecto ahora envía mensajes por HTTP y maneja adjuntos (subida y chips visuales).
- Web UI: dropzones de flujos robustecidas para evitar doble diálogo de archivo y mostrar nombre seleccionado.
- Documentación: README, docs/web.md, docs/api.md y docs/informes/repetitividad.md actualizados para reflejar rutas/endpoints reales y flujo del panel.
- Mate_y_Ruta.md actualizado al 2025-10-14.

## Contexto y alcance
- Problemas reportados: 404 en `/reports/index`, panel pidiendo adjuntar varias veces en Repetitividad, y chat sin responder.
- Alcance: Cambios en el microservicio `web` (plantillas, JS estático y rutas), y actualización de documentación del repositorio.

## Cambios realizados
- `web/web_app/main.py`: nueva ruta `GET /reports-history` y redirección `GET /reports/index` → `/reports-history`.
- `web/templates/panel.html`: botón “Carpeta de reportes” actualizado a `/reports-history`.
- `web/static/panel.js`: 
  - Dropzones: input oculto, sin doble click, muestra nombre.
  - Chat: submit HTTP y uploads con CSRF.
- Docs:
  - `README.md`: panel con Chat por defecto, `./Start --rebuild-frontend`, `/health/version`, nota de `/reports-history`.
  - `docs/web.md`: endpoints actualizados y frontend JS.
  - `docs/api.md`: agregado `/health/version` y documentado `/ingest/reclamos` (WIP).
  - `docs/informes/repetitividad.md`: período decorativo, histórico `/reports-history`, paths en `web`.
  - `docs/Mate_y_Ruta.md`: estado al 2025-10-14.

## Tareas realizadas y pendientes
- Realizado
  - Fix rutas histórico y redirect.
  - Chat HTTP básico y uploads desde panel.
  - Actualización de documentación clave.
- Pendiente
  - Tests adicionales para `/reports-history` (listado) y `/ingest/reclamos`.
  - Exponer metadata GEO en respuestas de reportes.
  - Persistir ingesta a DB (modelo/DAO) y pruebas.

## Criterios de aceptación
- Navegación al histórico desde el panel abre `/reports-history` sin 404 y lista archivos existentes con enlaces a `/reports/*`.
- Subir .xlsx en Repetitividad no reabre el diálogo de archivo de forma inmediata y se ve el nombre del archivo.
- Chat del panel: enviar texto genera respuesta; subir adjunto muestra chip y no rompe el formulario.
- Documentación: rutas y comandos reflejan el estado actual del repo.

## Impacto en seguridad y datos
- Sin exposición adicional de puertos. `/reports-history` sólo lista archivos ya servidos por `/reports`.
- CSRF se respeta en envíos del panel. No se loguea texto íntegro del usuario salvo `LOG_RAW_TEXT=true`.

## Compatibilidad y migraciones
- Sin cambios de schema. Comportamiento de rutas: `/reports/index` ahora redirige a `/reports-history`.

## Validación manual (resumen)
- `curl http://localhost:8080/health` → ok
- `curl -I http://localhost:8080/reports/index` → 302 Location: /reports-history
- Panel: cargar `repetitividad` con Excel de prueba → obtiene links /reports/*.docx y opcionalmente map.

## Próximos pasos
- Tests e2e para `/reports-history` y flujos del panel.
- Endpoint de features GEO en reportes.
- Ingesta persistente a DB y vista de métricas básicas.
